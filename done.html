<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>完了登録</title>
<link rel="stylesheet" href="style.css">
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
<div class="container" id="app"></div>

<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycby0tjXYVUWyPRwqs7r7PwJrrslfTCdZIeQmFwwT1JUfMF9N4a6XwXtgvMz-JDIzIt_mxQ/exec";

async function post(data){
  const res = await fetch(GAS_URL,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify(data)
  });
  return res.json();
}

async function getUserId(){
  const p = await liff.getProfile();
  return p.userId;
}

liff.init({ liffId:"YOUR_LIFF_ID" }).then(renderDone);

async function renderDone(){
  document.getElementById("app").innerHTML = `
    <h2>完了登録</h2>
    <div id="list"></div>
    <button id="done">完了</button>
  `;

  const userId = await getUserId();
  const list = await post({ action:"getUndoneHomework", userId });

  document.getElementById("list").innerHTML =
    list.map(v=>`
      <label class="check">
        <input type="checkbox" value="${v}">
        ${v}
      </label>
    `).join("");

  document.getElementById("done").onclick = async ()=>{
    const checked = [...document.querySelectorAll("input:checked")].map(i=>i.value);
    if(!checked.length) return;

    await post({ action:"doneHomework", userId, doneList: checked });
    alert("完了しました！");
    liff.closeWindow();
  };
}
</script>
</body>
</html>
