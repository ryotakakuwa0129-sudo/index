<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>完了登録</title>
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="animation.css">
</head>
<body class="card fade-in">
<h2>✅ 宿題完了</h2>
<form id="list"></form>
<button id="done">完了登録</button>

<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script src="liff.js"></script>
<script src="api.js"></script>
<script>
(async()=>{
  await initLiff();
  const userId = getUserId();
  const list = await api("getUndoneHomework",{userId});

  const form = document.getElementById("list");
  list.forEach(t=>{
    const l=document.createElement("label");
    l.innerHTML=`<input type="checkbox" value="${t}"> ${t}`;
    form.appendChild(l);
  });

  document.getElementById("done").onclick=async()=>{
    const done=[...form.querySelectorAll("input:checked")].map(x=>x.value);
    await api("doneHomework",{userId,doneList:done});
    location.reload();
  };
  document.getElementById("reg").onclick = async () => {
  await api("register", { userId: getUserId() });

  document.body.innerHTML = "<h2>登録完了しました</h2>";
  closeLiff(1200);   // 1.2秒後に閉じる
　};
})();
</script>
</body>
</html>
